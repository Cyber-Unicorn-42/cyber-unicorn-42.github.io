---
layout: post
read_time: true
show_date: true
title:  We'll be right, we have backups. Right. RIGHT!
date:   2022-06-25 10:00:00 +1000
description: What do I believe you should do around backups.
img: posts/2022-06-25-backups/hero.jpg
tags: [security,non-technical]
author: Peter Dodemont
---
I'm sure that by now everyone knows that you should be making backups of everything you have in your organisation. But how often should you back it up, where should you store the backups and how can you be sure that your backups actually work. These are the things I want to cover in this article. What I'll also do is go through some of my experiences with trying to implement backups over the course of my career.

## Backup Service Level Agreements
The very first thing you should do even before ever thinking about any of the policies I will discuss in this article is, talk to the business and agree a set of service level agreements (SLA's) and the systems that actually need to be backed up. Making sure you know what the business expects will help determine the overall strategy you put forward.  
SLA's for backups normally come in two different types, there is the Recovery Time Objectives (RTO's) and the Recovery Point Objectives (RPO's).  
RTO's define how long a particular system can be down before there is significant impact to the business. Where as RPO's define how much data can be lost before there is significant impact to the business.  
Both are usually defined in a time period being minutes, hours or days. They will differ between applications, but both can also be different for the same application. Let's take email as an example, and you might have an RPO of 30 minutes and an RTO of 4 hours. This means that you can only ever lose 30 minutes of emails, but the email system itself could be inaccessible for 4 hours before it becoming an issue.

## Backup Types
Another important item to consider is what type of backup you are going to be using, and if you are going to be using multiple different types (you probably will). The type is only the first of the different policies that will make up your backup strategy.  
The 2 most commonly used types of backups are full and incremental, there is also differential backups but I haven't ever come across it being used myself.  
Full backups, as the name implies, are a complete copy of the system you are backing up. You can use these to restore an entire system from this 1 backup. They take up the most amount of space and take the longest, as every time they run a complete copy of the system is made.  
Incremental backups only backup the files that have changed since the last backup (either full or incremental). The first backup will always be a full (as there is no older backup to see what has changed), but after that only the changes will be backed up. This reduces the size and time it takes to make a backup, but increases the time it takes to restore a full system, as you will first need to restore the full backup and then any subsequent incrementals. If you only need a single or handful of files you will be able to extract them from the relevant incremental backup and not impact restore time.  
Differential backups are similar to incremental backups in that they only back up changed files, but rather than the reference point being any backup, differential backups will back up changes since the last full backup. This positions them in between full and incremental backups both for size, time needed to backup and time needed to restore.
Let's take a simple example of a file server that is 50GB in size where around 2GB is added each day, 2GB is changed each day and the backup rate is 1 minute per GB of data. For the full backup you would have 50GB the first day with a backup time of 50 minutes, the second day it would be 52GB with a time of 52 minutes, the third day 54GB with a time of 54 minutes and so on. After a week you would have 392 GB of backup data with a total time of 392 minutes. For the incremental the first day is the same 50GB and 50 minutes, the second day you would only have 4GB and 4 minutes, the third day you once again have 4GB and 4 minutes and so forth. After a week you would have 74GB of backups and 74 minutes of time taken to back it up. Finally for the differential backups you again would have the 50GB and 50 minutes on the first day, the second day you would have 4GB and 4 minutes like the incremental, but on the third day you's have 8GB and 8 minutes and so on. After a week of differential backups you would have 134GB with 134 minutes of backup time.  
As you can see from the example full backups take significantly longer and use up more space, then comes differential, followed by incremental being the quickest.  
If we now look at restoring a full system on day 7 using the same example and a restore rate of 1GB per minutes, we will see that the full backup will take 62 minutes (as the final backup is 62GB in size), the incremental backup will take 74 minutes to restore (50 minutes for the full backup plus 4 minutes for every incremental since then), and the differential will also take 74 minutes to restore (50 minutes for the full backup and 24 minutes for the final differential).  
Now in a real world scenario there is probably some overlap between the files added and changed each day which would reduce the time of the differential backup slightly for both backup and restore time, but as you can see the reduction in time to restore of a differential is minimal. Yet it uses quite a bit more space and takes longer to backup than an incremental, which explains why I haven't used it myself or see it used. You can also see that, the longer incrementals keep going, the longer the restore time is going to be (which will become a problem for your RTO's). At first this problem was solved by taking full backups at set intervals to offset this, but backup solution providers have found an interesting alternative, "virtual" full backups. With these, after a set time, they will combine your original full and incremental backups to create a new "virtual" full backup. Reasons you might want to do this are, because it takes to long to do a full backup, or better utilize your backup server as it is usually idle in the daytime, or both. Meaning you would get the benefit of reduced time it take backups at night, having regular full backups and not have a server sit around under utilized.

## Backup Frequency
Now that you know the systems, the RPO's and RTO's for each system, and backup types you can try and work out what an appropriate frequency is for each of the systems and each type. Just like RPO's and RTO's frequency is usually measured in time, but it can also be measured in amount of change. Amount of change will look at your system and determine how much of the data has changed since the last backup and use that to determine when to perform the next backup (this is usually measures in percentages). For example if you have a file server you might specify that you want it backed up every time 5% of the files have changed, so the backup solution will track the overall number of files and the number of files changed, added, or removed since the last backup and once you exceed 5% of the total number of files it will kick off a backup. This can be useful for a specific backup type. For example you could trigger a full backup only after 50% change rather than at a set time interval.  
Going back to our email example, you can determine that you need to take backups of that system every 30 minutes to ensure that you never get to a point that you would have lost more than 30 minutes of email. So you can configure the backup solution to do a full backup overnight and then after that full backup an incremental backup every 30 minutes.

## Retention Policies
Another part of your backup strategy will be your retention. This is always measured in time (being days, weeks, months or years). Retention policies define how long you will keep a particular backup of a particular type for. Generally these are partly determined by your SLA's but also partly by regulatory requirements. Most places around the world define rules about how long a company needs to retain specific types of data for (e.g. financial data).  
An example of a retention policy could be that you keep the full backup you make at the beginning of the week for 3 months, but you only keep the incremental backups you make during the week for 2 weeks.

## Storage Policies
The final type of policy I want cover off is the storage policy. Storage policies define what type of storage a certain backup will be kept on. The most common types of storage are "local" disk, cloud and tape. "Local" disk generally refers to any storage that is hosted by the company itself in its racks or datacenter, cloud being storage hosted by a cloud provider and tapes referring to LTO tapes. I won't go to into what exactly an LTO tape is (you can find more info on them on [here](https://en.wikipedia.org/wiki/Linear_Tape-Open)), I'll just say that it's a standalone media type that you can physically store in a separate location. You can think of them as high density USB thumb drives that require a special tape drive to read and write.  
For example you might store your daily backups on local disk so you can easily access it for restores, but store the backups you make at the beginning of each month on cloud storage or tape storage.

## Backup Strategy
Now that I covered all the different policies, let's combine them all into the backup strategy. Creating the backup strategy requires balancing a number of different requirements. Not only the agreed SLA's, but also the cost to the business, available time windows for backups and legal requirements. For most small to medium business the strategy does end up looking very similar and most places I have worked at, the strategy has been as I outline below. This model strikes a nice balance between costs, manageability and risk reduction. 
I usually define 4 backup regimes being daily, weekly, monthly and yearly. The names purely reflect how often those backups are taken, and each will have it's own type, frequency, retention and storage policy. Let's break them down one at a time.  
Daily backups are taken at least once a day on days the business normally operates, but can be taken more often if needed. They are always incremental, are retained for 4 weeks and stored on local disk. These are the backups used when users (or anyone else) accidently delete something. Anecdotally about 90% of restores fall in this category.  
Weekly backups are usually taken over the weekend (since they can take a long time to complete) and are always full backups (this can be virtual full backups). Just like the dailies, they are retained for 4 weeks and are stored on local disk. The reason these have the same retention and storage as the dailies is because I used these as the initial full backup used for the daily incrementals.  
Monthly backups are taken at the end of each month and are also always full (again this can be a virtual full backup). The exact timing will vary from place to place. It could be the last saturday of the month or the last day of the month. This mostly depends on the impact the backups have on the system and how long it takes to do a full backup. Retention for monthly backups is usually 12 months and storage is either cloud or tape. These backups are, in my experience, most commonly used when rarely accessed files are changed or deleted (like files that only get used at the end of a quarter or year). They can actually coincide with weekly backups, which means they will surpercede them and the weekly will be skipped.  
Then we have the yearly backups. These happen at the end of the financial or calendar year and are always full backups as well (same as the other fulls this could be virtual). Retention on these matches what is required from a legal perspective so usually this is years. They are normally stored in the cloud or on tape. These backups are generally used if there is a legal case that requires you to dig up old data.
Some of the these backups can fall on at same time and in those cases the backups with the longest retention will supercede the other ones, given that the storage policy is the same.

## The 3-2-1 Rule
When you start reading up about backup policies you'll most likely come across the 3-2-1 rule. This rule states that you should have 3 copies of your data on 2 types of media with 1 being offsite. It is from an era where almost everyone had their data stored locally and not in the cloud. And while in general terms this is a great rule to follow, it is not the end all and be all. It also entirely depends on how you classify off-site and media. Is cloud storage off-site? Or a different type of media? Some people will say yes and some will say no and some will say both. Some might say it depends on how the cloud storage is connected or what type it is (e.g. hot vs cold cloud storage). Then there is LTO tapes, while everyone will agree it is a distinct type of media, storing it offsite correctly will come at a cost as well as introduce extra delays when you need to restore backups. Not too mention that over time the LTO standard changes and new tape drives only offer backwards compatability for at most 2 previous generations. Potentially causing issues to restore old yearly backups.  
So rather than follow this rule religiously I much rather take a more practical approach to see what works best for the business. These days this usually means that I no longer use tape drives, but instead would recommend the daily and weekly backups are stored locally (so they can be accessed quickly) and the monthly and yearly are in cloud storage with policies that will push the backups to cold storage. I won't go into details about cloud storage types, other than to say that cold storage is usually cheaper and rather than being immediately available, requires being loaded out of cold storage to be accessible.
The reason the rule is still popular is because it mitigates risks associated with malware being able to wipe out your backups. This is because if the copy is stored off-site (usually on tape) it cannot be affected by the malware. In my strategy the same is achieved by using cold cloud storage. Because it takes time to load this in, it cannot immediately be affected by malware. So it offers similar benefits to tapes, but at a reduced cost and is easier to manage.

## Restore Testing
One crucial part that is usually overlooked or not implemented is doing restore testing. It's all good and well to take backups, but if you don't actually test your backups, how do know your backups actually contain the data you backed up. The more often you can verify your backups the more confident you can be that when you need them they will be there for you.  
Testing can be done manually by simply restoring a server or part of a server and verifying that the system is operational or that the file you are after is there. But this is generally fairly labour intensive, so won't scale well. It is non the less a valid option if you only have a limited number of servers. You also don't "need" to test every backup every time. You can setup a schedule to do a restore test once a month, and do a different restore each time. While not ideal, it is a valid option depending on the risk appetite of the business.  
But, over the years many backup solutions have integrated ways that you can test backups automatically to confirm they are valid. And while this generally takes a bit of work up front to setup the scenarios and get everything lined up, once setup maintenance is usually minimal. The best thing about automated testing is that you can do this way more frequently and can test many more backups. You might not be able to automatically test every backup, but you can certainly reduce the amount you will have to do manually.  
Wether it's manual or automated, you really need to consider testing your backups as a crucial part of your backup strategy. Without testing you will very likely run into an problem where you will not be able to restore the files you need because of corruption, or an error occurred during the backup process, or even because the backups are not configured properly.


I haven't covered every possible scenario or option in the article, but I hope I provided you with enough information to define or improve on your backup strategy. As always, if you have any questions or comments please reach out.